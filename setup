#!/bin/bash
################################################################################
# setup
# This script creates symlinks from $HOME to the committed files in $HOME/dotfiles
################################################################################

# Variables
storage=$HOME/dotfiles/old # storage
files=($(git ls-tree --name-only master)) # get list of committed files

# Create storage for old dotfiles
echo "Creating $storage for backup of any existing dotfiles..."
[ ! -d $storage ] && mkdir $storage

# Move existing stuff to storage, then create symlinks 
# Only move if the item itself is not a symlink
for file in ${files[@]}; do # iterate through files
  if [ $file != "setup" ] && [ $file != ".gitignore" ]; then
    echo "Creating symlink to $file in $HOME..."
    # Be conservative
    if [ -L $HOME/$file ]; then
      rm $HOME/$file # remove if symlink
    elif [ -r $HOME/$file ]; then
      echo "Moving existing file \"$file\" to $storage..."
      mv -r $HOME/$file $storage/ # copy if not
    fi
    # Finally create symlink
    # Make sure source-file is path RELATIVE to 
    ln -s dotfiles/$file $HOME/$file
  fi
done
