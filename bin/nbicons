#!/usr/bin/env bash
# User array notation to expand pattern
base=~/anaconda3
icodir=($base/lib/python*/site-packages/notebook/static/base/images)
icofiles=($icodir/*.ico)
[ ! -d "$icodir" ] && echo "Error: Directory not found: \"$icodir\"." && exit 1
# Override information
pngdir=~/bin # override
tmp=$pngdir/tmp
[ ! -d "$tmp" ] && mkdir $tmp
pngfiles=($pngdir/*.png)
pngfiles=(${pngfiles[@]##*/})
for icofile in ${icofiles[@]##*/}; do
  if [[ " ${pngfiles[@]%.png} " =~ " ${icofile%.ico} " ]]; then
    echo "Overriding favicon with file \"${icofile%.ico}.png\"."
    tmpfiles=() # store here
    for reso in 16 32 48 128 256; do
      convert $pngdir/${icofile%.ico}.png -scale $reso $tmp/$reso.png
      tmpfiles+=($tmp/$reso.png)
    done
    convert ${tmpfiles[@]} $tmp/$icofile
    if [ ! -r $icodir/${icofile%.ico}-default.ico ]; then
      cp $icodir/$icofile $icodir/${icofile%.ico}-default.ico
    fi
    cp $tmp/$icofile $icodir/$icofile # move that shit over
  fi
done
rm -r $tmp # empty it out
